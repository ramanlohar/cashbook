<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jama Data</title>
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="sidebar.css">
    <style>
        #filterbtn #btn3 {
            background-color: white;
            color: black;
            border-radius: 7px 7px 0px 0px;
        }
    </style>
</head>

<body>
    <div id="sidebar">

    </div>
    <header>
        <div>
            <button id="menubtn" style="font-size:30px;cursor:pointer" onclick="openNav()">â˜°</button>
        </div>
        <div>
            <h2>Home</h2>
        </div>
        <div>
            <button id="editbtn">Edit</button>
        </div>
    </header>
    <!-- <div id="filterbtn">
        <button id="btn1">All</button>
        <button id="btn2">Baki</button>
        <button id="btn3">Jama</button>
    </div> -->
    <!-- <h2>Jama Data</h2> -->
    <div id="columndiv">
        <!-- EDIT -->
        <div id="column7" class="column">
            <label for="">EDIT</label>
            <ul id="jamaDataList7"></ul>
        </div>
        <!-- EDIT -->
        <div id="column0" class="column">
            <label for="">NO.</label>
            <ul id="jamaDataList0"></ul>
        </div>
        <div class="column">
            <label for="">Name</label>
            <ul id="jamaDataList1"></ul>
        </div>
        <div class="column">
            <label for="">Contact</label>
            <ul id="jamaDataList2"></ul>
        </div>
        <div class="column">
            <label for="">D_B_P</label>
            <ul id="jamaDataList3"></ul>
        </div>
        <div class="column">
            <label for="">Year</label>
            <ul id="jamaDataList4"></ul>
        </div>
        <div class="column">
            <label for="">CB_TYPE</label>
            <ul id="jamaDataList5"></ul>
        </div>
        <!-- 888888888888888888888888888888 -->
        <div id="column8" class="column">
            <label for="">Receive</label>
            <ul id="inputDataList8"></ul>
        </div>
        <div id="column9" class="column">
            <label for="">Send</label>
            <ul id="inputDataList9"></ul>
        </div>
        <div id="column10" class="column">
            <label for="">Money</label>
            <ul id="inputDataList10"></ul>
        </div>
        <!-- 10000000000000000000000000000 -->
        <div class="column">
            <label for="">J/B</label>
            <ul id="jamaDataList6"></ul>
        </div>
    </div>
    <footer class="footer">
        <div id="pricediv">
            <div>
                <label for="">Total Amount :</label>
                <input id="ttotal" type="text" readonly>
            </div>
            <div>
                <label for="">Total Deposit :</label>
                <input id="tjama" type="text" readonly>
            </div>
            <div>
                <label for="">Total Remaining :</label>
                <input id="tbaki" type="text" readonly>
            </div>
        </div>
        <button id="addbtn">Add Data</button>
    </footer>

    <script>
        getAllJamaData();

        function getAllJamaData() {
            // Loop through localStorage items
            var index = 1;
            for (var key in localStorage) {
                if (key.startsWith("CBDATA_")) {
                    var data = JSON.parse(localStorage.getItem(key));

                    // Assuming that datafiltervalue is a valid property of the data object
                    var filtervalue = localStorage.getItem("filtervalue");
                    var datafiltervalue = localStorage.getItem("datafiltervalue");
                    console.log(datafiltervalue);
                    var newBlock;
                    // newBlock = data.name;

                    if (datafiltervalue == "block") {
                        newBlock = data.block;
                        // alert("done");
                    }
                    else if (datafiltervalue == `bookType`) {
                        newBlock = data.bookType;
                    }
                    else if (datafiltervalue == `contactNo`) {
                        newBlock = data.contactNo;
                    }
                    else if (datafiltervalue == "dateReceive") {
                        newBlock = data.dateReceive;
                    }
                    else if (datafiltervalue == "dateSend") {
                        newBlock = data.dateSend;
                    }
                    else if (datafiltervalue == "district") {
                        newBlock = data.district;
                    }
                    else if (datafiltervalue == "name") {
                        newBlock = data.name;
                        // alert("name");
                    }
                    else if (datafiltervalue == "panchayat") {
                        newBlock = data.panchayat;
                    }
                    else if (datafiltervalue == "price") {
                        newBlock = data.price;
                    }
                    else if (datafiltervalue == "tpceType") {
                        newBlock = data.tpceType;
                    }
                    else if (datafiltervalue == "year") {
                        newBlock = data.year;
                    }

                    // const newBlock = data.panchayat;
                    // Check if the data satisfies the filter condition
                    if (newBlock === filtervalue) {
                        // Append the data to the corresponding column
                        appendToList("jamaDataList0", index, key);
                        appendToList("jamaDataList1", data.name, key);
                        appendToList("jamaDataList2", data.contactNo, key);
                        appendToList("jamaDataList3", `${data.district}, ${data.block}, ${data.panchayat}`, key);
                        appendToList("jamaDataList4", data.year, key);
                        appendToList("jamaDataList5", data.bookType, key);
                        appendToList("jamaDataList6", data.tpceType, key);
                        appendToList("jamaDataList7", '', key); // I left this as an empty string, update as needed
                        appendToList("inputDataList8", formatDate(data.dateReceive));
                        appendToList("inputDataList9", formatDate(data.dateSend));
                        appendToList("inputDataList10", data.price, key);

                        index++;
                    }
                }
            }
        }

        function appendToList(listId, data, key) {
            var jamaDataList = document.getElementById(listId);
            var listItem = document.createElement("li");
            listItem.textContent = data;

            // Add an Edit button to each list item in the "EDIT" column
            if (listId === "jamaDataList7") {
                var editButton = document.createElement("span");
                editButton.className = "edit-button";
                editButton.textContent = "Edit";
                editButton.addEventListener("click", function () {
                    // Set the key in localStorage for editing
                    localStorage.setItem("foreditkey", key);
                    // Redirect to the editinput.html page
                    window.location.href = "editinput.html";
                });

                listItem.appendChild(editButton);
            }

            jamaDataList.appendChild(listItem);
        }

        function formatDate(dateString) {

if (dateString == "" || dateString == "Panding..") {
    return `Panding...`;
}
else {

    // Convert the date to dd mm yyyy format
    var date = new Date(dateString);
    var day = date.getDate().toString().padStart(2, '0');
    var month = (date.getMonth() + 1).toString().padStart(2, '0');
    var year = date.getFullYear();

    return `${day}-${month}-${year}`;
}
}

        calculateTotals();

        function calculateTotals() {
            var totalBaki = 0;
            var totalJama = 0;
            var totalAll = 0;

            // Loop through localStorage items
            for (var key in localStorage) {
                if (key.startsWith("CBDATA_")) {
                    var data = JSON.parse(localStorage.getItem(key));

                    // Calculate total based on CB_TYPE
                    if (data.tpceType === "baki") {
                        totalBaki += parseFloat(data.price);
                    } else if (data.tpceType === "jama") {
                        totalJama += parseFloat(data.price);
                    }

                    // Calculate total for all entries
                    totalAll += parseFloat(data.price);
                }
            }

            // Output or use totals as needed
            console.log("Total Baki:", totalBaki);
            console.log("Total Jama:", totalJama);
            console.log("Total All:", totalAll);

            const tjama = document.querySelector("#tjama")
            tjama.value = totalJama;

        }

        // localStorage.setItem("filtervalue","");
    </script>
</body>
<script src="script.js"></script>
<script src="sidebar.js"></script>

</html>